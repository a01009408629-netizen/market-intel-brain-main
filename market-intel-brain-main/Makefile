# Market Intel Brain - Makefile
# Enterprise-grade build automation

.PHONY: help fix lint test build clean docker-build docker-run deploy

# Default target
help:
	@echo "Market Intel Brain - Enterprise Makefile"
	@echo ""
	@echo "Available commands:"
	@echo "  fix        - Fix Go dependencies and linting issues"
	@echo "  lint       - Run linting checks"
	@echo "  test       - Run all tests"
	@echo "  build      - Build all services"
	@echo "  clean      - Clean build artifacts"
	@echo "  docker-build - Build Docker images"
	@echo "  docker-run  - Run Docker containers"
	@echo "  deploy     - Deploy to production"
	@echo ""

# Fix Go dependencies and linting issues
fix:
	@echo "ğŸ”§ Fixing Go dependencies and linting issues..."
	@cd microservices/go-services/api-gateway && \
		go mod tidy && \
		go mod vendor && \
		golangci-lint run --fix && \
		echo "âœ… Go dependencies and linting fixed"

# Run linting checks
lint:
	@echo "ğŸ” Running linting checks..."
	@cd microservices/go-services/api-gateway && \
		golangci-lint run --timeout=10m && \
		echo "âœ… Go linting completed"
	@cd microservices/rust-services/core-engine && \
		cargo fmt --all -- --check && \
		cargo clippy --all-targets --all-features -- -D warnings && \
		echo "âœ… Rust linting completed"

# Run all tests
test:
	@echo "ğŸ§ª Running all tests..."
	@cd microservices/go-services/api-gateway && \
		go test -v ./... && \
		echo "âœ… Go tests completed"
	@cd microservices/rust-services/core-engine && \
		cargo test --all && \
		echo "âœ… Rust tests completed"

# Build all services
build:
	@echo "ğŸ—ï¸ Building all services..."
	@cd microservices/go-services/api-gateway && \
		go build -o bin/api-gateway ./cmd/main.go && \
		echo "âœ… Go service built"
	@cd microservices/rust-services/core-engine && \
		cargo build --release && \
		echo "âœ… Rust service built"

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@cd microservices/go-services/api-gateway && \
		rm -rf bin/ vendor/ && \
		go clean -modcache && \
		echo "âœ… Go artifacts cleaned"
	@cd microservices/rust-services/core-engine && \
		cargo clean && \
		echo "âœ… Rust artifacts cleaned"

# Build Docker images
docker-build:
	@echo "ğŸ³ Building Docker images..."
	@docker build -t market-intel/api-gateway:latest ./microservices/go-services/api-gateway && \
		echo "âœ… API Gateway Docker image built"
	@docker build -t market-intel/core-engine:latest ./microservices/rust-services/core-engine && \
		echo "âœ… Core Engine Docker image built"

# Run Docker containers
docker-run:
	@echo "ğŸš€ Running Docker containers..."
	@docker-compose -f docker-compose.yml up -d && \
		echo "âœ… Docker containers started"

# Deploy to production
deploy:
	@echo "ğŸš€ Deploying to production..."
	@echo "Deployment logic would go here"
	@echo "âœ… Deployment completed"

# Install development dependencies
install-deps:
	@echo "ğŸ“¦ Installing development dependencies..."
	@go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
	@echo "âœ… Development dependencies installed"
