name: Robust Project Error Auditor

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

# Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ÙØ­ÙˆØµØ§Øª Ù‚Ø¯ÙŠÙ…Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù†ÙØ³ Ø§Ù„Ù€ Pull Request Ù„ØªÙˆÙÙŠØ± Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø³ÙŠØ±ÙØ±
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  python-audit:
    name: ğŸ Python Audit
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # ÙŠÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø³Ø®Ø© Ø£Ø­Ø¯Ø«
          cache: 'pip'         # ØªØ³Ø±ÙŠØ¹ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ -f requirements_production.txt ]; then pip install -r requirements_production.txt; fi
          # ØªØ«Ø¨ÙŠØª Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙØ­Øµ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
          pip install ruff mypy bandit

      - name: ğŸ” Syntax & Quality Check (Ruff)
        # Ruff Ù‡Ùˆ Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ø£Ø³Ø±Ø¹ ÙˆØ§Ù„Ø£ÙƒØ«Ø± Ø¯Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        run: ruff check .

      - name: ğŸ›¡ï¸ Type Checking (Mypy)
        # ÙØ­Øµ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø²Ø§Ù„Ø© || true Ù„Ø¬Ø¹Ù„Ù‡ Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ§Ù‹)
        run: mypy . --ignore-missing-imports || true 

      - name: ğŸ”’ Security Check (Bandit)
        # ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙÙŠ ÙƒÙˆØ¯ Ø¨Ø§ÙŠØ«ÙˆÙ†
        run: bandit -r . -ll -ii || true

      - name: ğŸ§ª Test Basic Functionality
        # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        run: |
          if [ -f test_basic.py ]; then python test_basic.py; fi

  node-audit:
    name: ğŸ“¦ Node.js Audit
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'   # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø³Ø®Ø© LTS Ø­Ø¯ÙŠØ«Ø©
          cache: 'npm'

      - name: Install Dependencies (Clean Install)
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… npm ci Ø£Ø³Ø±Ø¹ ÙˆØ£ÙƒØ«Ø± Ù…ÙˆØ«ÙˆÙ‚ÙŠØ© ÙÙŠ Ø¨ÙŠØ¦Ø§Øª Ø§Ù„Ù€ CI Ù…Ù† npm install
        run: |
          if [ -f package-lock.json ]; then npm ci; else npm install; fi

      - name: ğŸ” Linting Check (ESLint)
        # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ package.json
        run: |
          if npm run | grep -q 'lint'; then npm run lint; fi

      - name: ğŸ›¡ï¸ TypeScript Check (if applicable)
        # ÙØ­Øµ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§ÙŠØ¨ Ø³ÙƒØ±ÙŠØ¨Øª Ø¨Ø¯ÙˆÙ† Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ (Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹)
        run: |
          if [ -f tsconfig.json ]; then npx tsc --noEmit; fi

      - name: ğŸ—ï¸ Build Test
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¨Ù†Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­
        run: |
          if [ -f package.json ]; then npm run build --if-present; fi

      - name: ğŸ”’ Dependency Security Audit
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø«ØºØ±Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø­Ø²Ù…
        run: npm audit --audit-level=high || true
